<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GORILLA WARFARE // ADMIN</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500&display=swap');

        :root {
            /* THEME: Deep Purple / Blue */
            --bg-grad-1: #0a0510;
            --bg-grad-2: #020202;
            --card-bg: rgba(25, 20, 35, 0.9);
            --card-border: rgba(100, 80, 255, 0.15);
            --accent: #7c3aed; 
            --accent-glow: #8b5cf6;
            --text-main: #ffffff;
            --text-dim: #9ca3af;
            --green: #10b981;
            --red: #ef4444;
            --font-main: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        body {
            background: linear-gradient(135deg, var(--bg-grad-1) 0%, var(--bg-grad-2) 100%);
            color: var(--text-main);
            font-family: var(--font-main);
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            cursor: none; /* Hide default cursor */
        }

        /* --- RESTORED WHITE 4x4 CURSOR --- */
        #cursor {
            position: fixed; top: 0; left: 0; 
            width: 4px; height: 4px; 
            background: white; 
            pointer-events: none;
            z-index: 9999; 
            box-shadow: 0 0 8px white;
            transform: translate(-50%, -50%);
            mix-blend-mode: difference;
        }

        /* --- LAYOUT --- */
        #sidebar {
            width: 250px; background: rgba(0,0,0,0.4);
            border-right: 1px solid var(--card-border);
            display: flex; flex-direction: column; padding: 25px;
            backdrop-filter: blur(10px);
        }

        #main { flex: 1; padding: 40px; display: flex; flex-direction: column; position: relative; }

        /* --- ANIMATIONS --- */
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes glow { 0% { border-color: var(--card-border); } 50% { border-color: var(--accent-glow); } 100% { border-color: var(--card-border); } }

        /* --- COMPONENTS --- */
        h1, h2 { margin: 0; font-weight: 800; letter-spacing: -0.5px; }
        
        .card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 30px rgba(0,0,0,0.5);
            animation: slideIn 0.4s ease-out;
        }

        /* --- INPUTS & BUTTONS --- */
        .search-bar {
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--card-border);
            padding: 15px; border-radius: 8px; color: white; font-family: var(--font-main);
            outline: none; margin-bottom: 20px; cursor: none; transition: 0.2s; box-sizing: border-box;
        }
        .search-bar:focus { border-color: var(--accent-glow); background: rgba(124, 58, 237, 0.05); }

        .btn { padding: 10px 20px; border-radius: 6px; border: none; font-weight: 700; cursor: none; transition: 0.2s; text-transform: uppercase; font-size: 0.8em; letter-spacing: 1px; }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.2); }
        .btn-danger { background: var(--red); color: white; box-shadow: 0 0 15px rgba(239, 68, 68, 0.2); }
        .btn-ghost { background: transparent; border: 1px solid var(--card-border); color: #ccc; }
        .btn-ghost:hover { border-color: white; color: white; background: rgba(255,255,255,0.05); }
        .btn-login { width: 100%; background: var(--accent); color: white; padding: 15px; box-shadow: 0 0 20px rgba(124, 58, 237, 0.3); }

        /* --- PLAYER LIST --- */
        .player-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px; margin-bottom: 10px; border-radius: 8px;
            background: rgba(255,255,255,0.03); transition: 0.2s;
            border: 1px solid transparent;
            animation: slideIn 0.3s backwards;
        }
        .player-row:hover { background: rgba(255,255,255,0.07); transform: translateX(5px); border-color: var(--accent); }

        .p-info { display: flex; align-items: center; gap: 15px; }
        .p-avatar { width: 40px; height: 40px; background: linear-gradient(135deg, var(--accent), #4c1d95); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 1px solid rgba(255,255,255,0.1); }
        
        .badge { padding: 4px 10px; border-radius: 4px; font-size: 0.75em; font-weight: bold; text-transform: uppercase; }
        .b-clean { background: rgba(16, 185, 129, 0.15); color: var(--green); border: 1px solid rgba(16, 185, 129, 0.2); }
        .b-banned { background: rgba(239, 68, 68, 0.15); color: var(--red); border: 1px solid rgba(239, 68, 68, 0.2); }

        /* --- LOGIN OVERLAY --- */
        #login { position: fixed; inset: 0; background: var(--bg-grad-1); z-index: 50; display: flex; justify-content: center; align-items: center; }
        
        /* --- MODAL --- */
        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 100; justify-content: center; align-items: center; backdrop-filter: blur(8px); }
        
    </style>
</head>
<body>
    <div id="cursor"></div>

    <div id="login">
        <div class="card" style="width: 380px; text-align: center;">
            <h1 style="margin-bottom: 5px; font-size: 2em;">GORILLA <span style="color:var(--accent-glow)">WARFARE</span></h1>
            <p style="color: var(--text-dim); margin-bottom: 30px; font-size: 0.9em; letter-spacing: 1px;">ADMINISTRATION</p>
            
            <input type="text" id="api" value="https://sanctionbanepiconlineservicesystem.onrender.com" class="search-bar" placeholder="Server URL">
            <input type="password" id="pass" class="search-bar" placeholder="Access Key">
            <button onclick="auth()" class="btn btn-login">INITIALIZE</button>
            <p id="msg" style="color:var(--red); margin-top:15px; font-size:0.8em; min-height: 1.2em;"></p>
        </div>
    </div>

    <div id="dashboard" style="display:none; width:100%; height:100%;">
        <div id="sidebar">
            <h2 style="margin-bottom: 40px; color: white;">GW <span style="color:var(--accent)">PANEL</span></h2>
            
            <div style="color: var(--text-dim); font-size: 0.75em; margin-bottom: 10px; font-weight: bold; letter-spacing: 1px;">MAIN</div>
            <div style="padding: 12px; background: var(--accent); border-radius: 6px; margin-bottom: 5px; color: white; font-weight: 600; font-size: 0.9em;">Player Database</div>
            <div style="padding: 12px; color: var(--text-dim); font-size: 0.9em;">Server Logs</div>
            <div style="padding: 12px; color: var(--text-dim); font-size: 0.9em;">Settings</div>
            
            <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid var(--card-border);">
                <div style="font-size: 0.8em; color: var(--text-dim);">SYSTEM STATUS</div>
                <div style="color: var(--green); font-weight: bold; font-size: 0.9em; margin-top: 5px;">‚óè OPERATIONAL</div>
            </div>
        </div>

        <div id="main">
            <div style="display: flex; justify-content: space-between; margin-bottom: 25px; align-items: center;">
                <h1 style="font-size: 1.8em;">Database</h1>
                <button onclick="refresh()" class="btn btn-ghost">REFRESH DATA</button>
            </div>

            <div class="card" style="margin-bottom: 20px; padding: 10px;">
                <input type="text" id="search" onkeyup="render()" class="search-bar" style="margin:0; border:none; background: transparent;" placeholder="Filter by Name or ID...">
            </div>

            <div id="list" style="overflow-y: auto; flex: 1; padding-right: 5px;"></div>
        </div>
    </div>

    <div id="modal">
        <div class="card" style="width: 450px; border: 1px solid var(--red);">
            <h2 style="color:var(--red); margin-bottom: 10px;">SANCTION PLAYER</h2>
            <div style="color:var(--text-dim); margin-bottom: 25px; font-size: 0.9em; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 4px;">Target: <span id="m-target" style="color:white; font-weight:bold;"></span></div>
            
            <input type="text" id="m-reason" class="search-bar" placeholder="Violation Reason">
            <input type="number" id="m-time" class="search-bar" placeholder="Duration (Minutes) - 0 for Perma">
            
            <div style="display: flex; gap: 15px;">
                <button onclick="closeModal()" class="btn btn-ghost" style="flex:1;">CANCEL</button>
                <button onclick="commitBan()" class="btn btn-danger" style="flex:1;">CONFIRM BAN</button>
            </div>
        </div>
    </div>

    <script>
        // --- CURSOR LERP ---
        const c = document.getElementById('cursor');
        let mx = 0, my = 0, cx = 0, cy = 0;
        document.addEventListener('mousemove', e => { mx = e.clientX; my = e.clientY; });
        function loop() {
            cx += (mx - cx) * 0.2; cy += (my - cy) * 0.2;
            c.style.left = cx + 'px'; c.style.top = cy + 'px';
            requestAnimationFrame(loop);
        }
        loop();

        // --- APP LOGIC ---
        let API="", TOKEN="", DB=[], SEL="";

        async function auth() {
            let u = document.getElementById('api').value.replace(/\/$/,"");
            let p = document.getElementById('pass').value;
            let m = document.getElementById('msg');
            m.innerText = "AUTHENTICATING...";
            
            try {
                let r = await fetch(u+'/api/players', {headers:{'x-admin-auth':p}});
                if(!r.ok) throw "ACCESS DENIED";
                API=u; TOKEN=p; DB=(await r.json()).players;
                
                document.getElementById('login').style.opacity = 0;
                setTimeout(() => {
                    document.getElementById('login').style.display='none';
                    document.getElementById('dashboard').style.display='flex';
                    render();
                }, 500);
            } catch(e) { m.innerText="CONNECTION FAILED"; }
        }

        async function refresh() {
            try {
                let r = await fetch(API+'/api/players', {headers:{'x-admin-auth':TOKEN}});
                DB = (await r.json()).players;
                render();
            } catch(e) { console.error(e); }
        }

        function render() {
            let l=document.getElementById('list'), s=document.getElementById('search').value.toLowerCase();
            l.innerHTML="";
            
            if(DB.length === 0) {
                l.innerHTML = `<div style="text-align:center; color:#555; margin-top:50px;">DATABASE EMPTY - WAITING FOR PLAYERS</div>`;
                return;
            }

            DB.filter(p => (p.username||"").toLowerCase().includes(s) || p.productUserId.includes(s)).forEach((p, i) => {
                // Ignore ghost users
                if(p.productUserId === "undefined" || !p.productUserId) return;

                let div = document.createElement('div');
                div.className = "player-row";
                div.style.animationDelay = (i * 0.05) + "s";
                
                let badge = p.isBanned ? `<span class="badge b-banned">BANNED</span>` : `<span class="badge b-clean">CLEAN</span>`;
                let action = p.isBanned 
                    ? `<button onclick="unban('${p.productUserId}')" class="btn btn-ghost" style="color:var(--green); border-color:var(--green); padding: 8px 12px;">REVOKE</button>`
                    : `<button onclick="openModal('${p.productUserId}', '${p.username}')" class="btn btn-danger" style="padding: 8px 12px;">BAN</button>`;

                div.innerHTML = `
                    <div class="p-info">
                        <div class="p-avatar">${(p.username||"?")[0].toUpperCase()}</div>
                        <div>
                            <div style="font-weight:bold; font-size:1.1em; color:white;">${p.username||"Unknown"}</div>
                            <div style="font-family:monospace; color:var(--text-dim); font-size:0.8em;">${p.productUserId}</div>
                        </div>
                    </div>
                    <div style="display:flex; gap:20px; align-items:center;">
                        <div style="font-size:0.9em; color:var(--text-dim); display:flex; gap:15px;">
                            <span>üí∞ ${p.sheckles||0}</span> <span>‚öôÔ∏è ${p.scrap||0}</span>
                        </div>
                        ${badge}
                        ${action}
                        <button onclick="del('${p.productUserId}')" class="btn btn-ghost" style="padding:8px; width:30px; display:flex; justify-content:center;">‚úï</button>
                    </div>
                `;
                l.appendChild(div);
            });
        }

        function openModal(id, name) { SEL=id; document.getElementById('m-target').innerText=name; document.getElementById('modal').style.display='flex'; }
        function closeModal() { document.getElementById('modal').style.display='none'; }

        async function commitBan() {
            if(!SEL) return;
            let r = document.getElementById('m-reason').value;
            let m = document.getElementById('m-time').value;
            await fetch(API+'/api/ban', {
                method:'POST', headers:{'Content-Type':'application/json','x-admin-auth':TOKEN},
                body:JSON.stringify({productUserId:SEL, reason:r, durationMinutes:m})
            });
            closeModal(); refresh();
        }

        async function unban(id) {
            if(confirm("Confirm Revoke Sanction?")) {
                await fetch(API+'/api/unban', {method:'POST', headers:{'Content-Type':'application/json','x-admin-auth':TOKEN}, body:JSON.stringify({productUserId:id})});
                refresh();
            }
        }
        
        async function del(id) {
            if(confirm("‚ö† PERMANENTLY DELETE RECORD? This cannot be undone.")) {
                await fetch(API+'/api/delete', {method:'POST', headers:{'Content-Type':'application/json','x-admin-auth':TOKEN}, body:JSON.stringify({productUserId:id})});
                refresh();
            }
        }
    </script>
</body>
</html>
